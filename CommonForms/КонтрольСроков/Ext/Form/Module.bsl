
&НаСервере
Функция СписокВТЗ()
    // Получаем СКД с текстом запроса
    СКД_запрос = Элементы.СписокДОПросроченные.ПолучитьИсполняемуюСхемуКомпоновкиДанных();

    // Получаем настройки пользователя (отборы, сортировки и т.п.)
    Настройки = Элементы.СписокДОПросроченные.ПолучитьИсполняемыеНастройкиКомпоновкиДанных();

    // Переводим динамический список в таблицу значений
    КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных();
    МакетКомпоновки = КомпоновщикМакета.Выполнить(СКД_запрос, Настройки, , ,Тип("ГенераторМакетаКомпоновкиДанныхДляКоллекцииЗначений"));

    ПроцессорКомпоновкиДанных = Новый ПроцессорКомпоновкиДанных;
    ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновки);

    ПроцессорВыводаРезультата = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВКоллекциюЗначений;
    ТЗ = ПроцессорВыводаРезультата.Вывести(ПроцессорКомпоновкиДанных);// Таблица значений

    Возврат ТЗ;
КонецФункции

&НаСервере
Процедура ПолучитьКоличествоСтрокВДинамическомСпискеНаСервере() Экспорт
	ТЗ_ДС = СписокВТЗ();
	КолСтрокДС = ТЗ_ДС.Количество();
	Если КолСтрокДС > 1 Тогда
		ЭтаФорма.ЕстьПросроченные = Истина;
	Иначе
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура СписокДОВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	Если ЭтаФорма.ТекущийЭлемент = ЭтаФорма.Элементы.СписокДООбработанные И Элементы.СписокДООбработанные.ТекущиеДанные <> Неопределено Тогда
		ОткрытьЗначение(Элементы.СписокДООбработанные.ТекущиеДанные.Ссылка);
	ИначеЕсли ЭтаФорма.ТекущийЭлемент = ЭтаФорма.Элементы.СписокДОПросроченные И Элементы.СписокДОПросроченные.ТекущиеДанные <> Неопределено Тогда
        ОткрытьЗначение(Элементы.СписокДОПросроченные.ТекущиеДанные.Ссылка);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура Обновить(Команда)
	Элементы.СписокДООбработанные.Обновить();
КонецПроцедуры

&НаКлиенте
Процедура ДолжникМероприятия(Команда)
	Если ЭтаФорма.ТекущийЭлемент = ЭтаФорма.Элементы.СписокДООбработанные И Элементы.СписокДООбработанные.ТекущиеДанные <> Неопределено Тогда
		// Передать с ключом
		К = Элементы.СписокДООбработанные.ТекущиеДанные.Ссылка;
		ФормаМероприятия = ПолучитьФорму("Задача.Мероприятие.Форма.ФормаСписка",,,Новый УникальныйИдентификатор());
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбораДинамическогоСписка(ФормаМероприятия.Список, "Объект", К, ВидСравненияКомпоновкиДанных.Равно, , Истина, РежимОтображенияЭлементаНастройкиКомпоновкиДанных.Недоступный, );
		ФормаМероприятия.Элементы.ФормаДолжникМероприятия.Доступность = Ложь;
		ФормаМероприятия.Открыть();
	ИначеЕсли ЭтаФорма.ТекущийЭлемент = ЭтаФорма.Элементы.СписокДОПросроченные И Элементы.СписокДОПросроченные.ТекущиеДанные <> Неопределено Тогда
		// Передать с ключом
		К = Элементы.СписокДОПросроченные.ТекущиеДанные.Ссылка;
		ФормаМероприятия = ПолучитьФорму("Задача.Мероприятие.Форма.ФормаСписка",,,Новый УникальныйИдентификатор());
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбораДинамическогоСписка(ФормаМероприятия.Список, "Объект", К, ВидСравненияКомпоновкиДанных.Равно, , Истина, РежимОтображенияЭлементаНастройкиКомпоновкиДанных.Недоступный, );
		ФормаМероприятия.Элементы.ФормаДолжникМероприятия.Доступность = Ложь;
		ФормаМероприятия.Открыть();
	Иначе
		Предупреждение("Не найден объект отбора!",,"Контроль сроков");
	КонецЕсли;
КонецПроцедуры

