
Процедура ПриЗаписи(Отказ, Замещение)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	Запрос = Новый Запрос("ВЫБРАТЬ
	                      |	СостоянияПоКатегориямОстатки.Скоринг КАК Скоринг,
	                      |	СостоянияПоКатегориямОстатки.Категория КАК Категория,
	                      |	СостоянияПоКатегориямОстаткиРС.Скоринг КАК СкорингРС,
	                      |	СостоянияПоКатегориямОстатки.Объект КАК Объект,
	                      |	СостоянияПоКатегориямОстаткиРС.Объект КАК ОбъектРС
	                      |ИЗ
	                      |	РегистрНакопления.СостоянияПоКатегориям.Остатки(, ) КАК СостоянияПоКатегориямОстатки
	                      |		ПОЛНОЕ СОЕДИНЕНИЕ РегистрСведений.СостоянияПоКатегориямОстатки КАК СостоянияПоКатегориямОстаткиРС
	                      |		ПО СостоянияПоКатегориямОстатки.Объект = СостоянияПоКатегориямОстаткиРС.Объект
	                      |			И СостоянияПоКатегориямОстатки.Скоринг = СостоянияПоКатегориямОстаткиРС.Скоринг
	                      |ГДЕ
	                      |	ЕСТЬNULL(СостоянияПоКатегориямОстатки.Категория, НЕОПРЕДЕЛЕНО) <> ЕСТЬNULL(СостоянияПоКатегориямОстаткиРС.Категория, НЕОПРЕДЕЛЕНО)"); 
	Результат = Запрос.Выполнить().Выбрать();
	Пока Результат.Следующий() Цикл
		Если Результат.Объект = Null Тогда //Надо удалить из РС
			Набор = РегистрыСведений.СостоянияПоКатегориямОстатки.СоздатьМенеджерЗаписи();
			Набор.Объект = Результат.ОбъектРС;
			Набор.Скоринг = Результат.СкорингРС;
			Набор.Прочитать();
			Попытка
				Набор.Удалить();
			Исключение
				Отказ = Истина;
				Возврат;
			КонецПопытки;	
				
		Иначе //Надо добавить в РС
			Набор = РегистрыСведений.СостоянияПоКатегориямОстатки.СоздатьМенеджерЗаписи();
			Набор.Объект = Результат.Объект;
			Набор.Скоринг = Результат.Скоринг;
			Набор.Категория = Результат.Категория;
			Попытка 
				Набор.Записать();
			Исключение
				Отказ = Истина;
				Возврат;
			КонецПопытки;
		КонецЕсли;
	КонецЦикла;
	
	
	//
	Справочники.ФункцииДополнительныхСвойств.ПроставитьЗначенияДопСвойств(ЭтотОбъект, 
			Перечисления.ИнициаторыСобытийДляДопСвойств.СостоянияПоКатегориям);
КонецПроцедуры
