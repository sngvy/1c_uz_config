
&НаСервере
Процедура ПриОткрытииНаСервере()
	ЭтаФорма.Авторизованный = ПользователиКлиентСервер.АвторизованныйПользователь();
	ЭтаФорма.Дисконт = Перечисления.ТипыУсловийПоДоговору.Дисконт;
	ЭтаФорма.ДисконтИРеструктуризация = Перечисления.ТипыУсловийПоДоговору.ДисконтИРеструктуризация;
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	// Получим непредопредленное значение с сервера
	ПриОткрытииНаСервере();
	// Скрыть данные до конца расчетов
	ЭтаФорма.Элементы.Дисконт.Видимость = Ложь;
	ЭтаФорма.Элементы.Реструктуризация.Видимость = Ложь;
	ЭтаФорма.Элементы.ФормаСоздатьДокумент.Видимость = Ложь;
КонецПроцедуры

&НаКлиенте
Процедура Рассчитать(Команда)
	// Проверить правильность заполнения и произвести расчет
	Если СрокПогашения = 0 Тогда
		Предупреждение("Не задан срок погашения!",,"Расчет условий");
		Возврат;
	ИначеЕсли Быстроденьги = Ложь
		И ДжетМани = Ложь
		И ЛигаДенег = Ложь
		И Турбозайм = Ложь
		И ФинКоллект = Ложь
		И Мили = Ложь
		И ГлавныйЗайм = Ложь Тогда
		Предупреждение("Не выбран кредитор!",,"Расчет условий");
	ИначеЕсли СрокПогашения = 1 Тогда
		ЭтаФорма.Элементы.Дисконт.Видимость = Истина;
		ЭтаФорма.Элементы.Реструктуризация.Видимость = Ложь;
		ЭтаФорма.Элементы.ФормаСоздатьДокумент.Видимость = Истина;
	ИначеЕсли СрокПогашения > 1 Тогда
		ЭтаФорма.Элементы.Дисконт.Видимость = Ложь;
		ЭтаФорма.Элементы.Реструктуризация.Видимость = Истина;
		ЭтаФорма.Элементы.ФормаСоздатьДокумент.Видимость = Истина;
	КонецЕсли;
	
	Если Быстроденьги = Истина Тогда
		СуммаКЗакрытиюДисконт = СуммаОстатка - (СуммаОстатка * 0.25);
		СуммаКЗакрытиюРеструктуризация = СуммаОстатка - (СуммаОстатка * 0.20);
		ЕжемесячныйПлатеж = (СуммаОстатка - (СуммаОстатка * 0.20)) / СрокПогашения;
		СуммаДисконта = СуммаОстатка - СуммаКЗакрытиюДисконт;
		СуммаДисконтаРеструктуризация = СуммаОстатка - СуммаКЗакрытиюРеструктуризация;
	КонецЕсли;
	
	Если ФинКоллект = Истина Тогда
		СуммаКЗакрытиюДисконт = СуммаОстатка - (СуммаОстатка * 0.40);
		СуммаКЗакрытиюРеструктуризация = СуммаОстатка - (СуммаОстатка * 0.15);
		ЕжемесячныйПлатеж = (СуммаОстатка - (СуммаОстатка * 0.15)) / СрокПогашения;
		СуммаДисконта = СуммаОстатка - СуммаКЗакрытиюДисконт;
		СуммаДисконтаРеструктуризация = СуммаОстатка - СуммаКЗакрытиюРеструктуризация;
	КонецЕсли;
	
	Если ЛигаДенег = Истина Тогда
		СуммаКЗакрытиюДисконт = СуммаОстатка - (СуммаОстатка * 0.40);
		СуммаКЗакрытиюРеструктуризация = СуммаОстатка - (СуммаОстатка * 0.30);
		ЕжемесячныйПлатеж = (СуммаОстатка - (СуммаОстатка * 0.30)) / СрокПогашения;
		СуммаДисконта = СуммаОстатка - СуммаКЗакрытиюДисконт;
		СуммаДисконтаРеструктуризация = СуммаОстатка - СуммаКЗакрытиюРеструктуризация;
	КонецЕсли;
	
	Если Турбозайм = Истина Тогда
		СуммаКЗакрытиюДисконт = СуммаОстатка - (СуммаОстатка * 0.40);
		СуммаКЗакрытиюРеструктуризация = СуммаОстатка - (СуммаОстатка * 0.30);
		ЕжемесячныйПлатеж = (СуммаОстатка - (СуммаОстатка * 0.30)) / СрокПогашения;
		СуммаДисконта = СуммаОстатка - СуммаКЗакрытиюДисконт;
		СуммаДисконтаРеструктуризация = СуммаОстатка - СуммаКЗакрытиюРеструктуризация;
	КонецЕсли;
	
	Если ГлавныйЗайм = Истина Тогда
		СуммаКЗакрытиюДисконт = СуммаОстатка - (СуммаОстатка * 0.50);
		СуммаКЗакрытиюРеструктуризация = СуммаОстатка - (СуммаОстатка * 0.40);
		ЕжемесячныйПлатеж = (СуммаОстатка - (СуммаОстатка * 0.40)) / СрокПогашения;
		СуммаДисконта = СуммаОстатка - СуммаКЗакрытиюДисконт;
		СуммаДисконтаРеструктуризация = СуммаОстатка - СуммаКЗакрытиюРеструктуризация;
	КонецЕсли;
	
	Если ДжетМани = Истина Тогда
		СуммаКЗакрытиюДисконт = СуммаОстатка - (СуммаОстатка * 0.35);
		СуммаКЗакрытиюРеструктуризация = СуммаОстатка - (СуммаОстатка * 0.20);
		ЕжемесячныйПлатеж = (СуммаОстатка - (СуммаОстатка * 0.20)) / СрокПогашения;
		СуммаДисконта = СуммаОстатка - СуммаКЗакрытиюДисконт;
		СуммаДисконтаРеструктуризация = СуммаОстатка - СуммаКЗакрытиюРеструктуризация;
	КонецЕсли;
	
	Если Мили = Истина Тогда
		СуммаКЗакрытиюДисконт = СуммаОстатка - (СуммаОстатка * 0.40);
		СуммаКЗакрытиюРеструктуризация = СуммаОстатка - (СуммаОстатка * 0.30);
		ЕжемесячныйПлатеж = (СуммаОстатка - (СуммаОстатка * 0.30)) / СрокПогашения;
		СуммаДисконта = СуммаОстатка - СуммаКЗакрытиюДисконт;
		СуммаДисконтаРеструктуризация = СуммаОстатка - СуммаКЗакрытиюРеструктуризация;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СоздатьДокумент(Команда)
	// Заполнить документ
	ФормаДок = ПолучитьФорму("Документ.ДисконтИРеструктуризация.Форма.ФормаДокумента",,,Новый УникальныйИдентификатор());
	Если СрокПогашения = 1 Тогда
		ФормаДок.Объект.Тип = ЭтаФорма.Дисконт;
		ФормаДок.Объект.СуммаКЗакрытию = ЭтаФорма.СуммаКЗакрытиюДисконт;
		ФормаДок.Объект.СуммаДисконта = ЭтаФорма.СуммаДисконта;
		ФормаДок.Объект.СрокПогашения = ЭтаФорма.СрокПогашения;
		ФормаДок.Объект.ЕжемесячныйПлатеж = ЭтаФорма.СуммаКЗакрытиюДисконт;
	ИначеЕсли СрокПогашения > 1 Тогда
		ФормаДок.Объект.Тип = ЭтаФорма.ДисконтИРеструктуризация;
		ФормаДок.Объект.СуммаКЗакрытию = ЭтаФорма.СуммаКЗакрытиюРеструктуризация;
		ФормаДок.Объект.СуммаДисконта = ЭтаФорма.СуммаДисконтаРеструктуризация;
		ФормаДок.Объект.СрокПогашения = ЭтаФорма.СрокПогашения;
		ФормаДок.Объект.ЕжемесячныйПлатеж = ЭтаФорма.ЕжемесячныйПлатеж;
	КонецЕсли;
	ФормаДок.Объект.Договор = ЭтаФорма.СкрытоеПолеНомерДО;
	ФормаДок.Объект.Ответственный = ЭтаФорма.Авторизованный;
	ЭтаФорма.Закрыть();
	ФормаДок.Открыть();
КонецПроцедуры
